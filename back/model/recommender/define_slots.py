"""상황/관계 슬롯 및 금기어 정의."""

from __future__ import annotations

import re
from typing import Dict, List, Pattern

from define_stopwords import nfkc_lower

# 상황 슬롯 매핑
OCCASION_MAP: Dict[str, List[str]] = {
    "생일": ["생일", "birthday", "bday", "생신"],
    "집들이": ["집들이", "입주", "이사"],
    "기념일": ["기념일", "anniversary", "anniv", "기념", "100일", "200일", "1주년", "돌"],
    "감사": ["감사", "땡큐", "사은", "고마움", "감동"],
    "졸업": ["졸업", "졸업식"],
    "입사": ["입사", "취업", "입사축하"],
    "입학/합격": ["입학", "합격", "새학기", "신학기", "입시", "등록"],
    "승진/이직": ["승진", "진급", "이직", "프로모션", "승급"],
    "결혼": ["결혼", "웨딩", "신혼", "혼수"],
    "출산": ["출산", "출산선물", "돌잔치", "백일"],
    "위로": ["위로", "격려", "힐링", "응원"],
    "여행": ["여행", "휴가", "트립", "캠핑", "글램핑", "차박"],
    "운동": ["운동", "헬스", "pt", "피트니스", "요가", "필라테스", "러닝"],
    "집콕/취미": ["집콕", "홈캠핑", "취미", "덕질", "핸드메이드", "공방"],
    "명절": ["명절", "설", "추석", "새해", "설날", "추석선물"],
    # 시즌/기념일 추가
    "발렌타인": ["발렌타인", "발렌타인데이", "초콜릿데이"],
    "화이트데이": ["화이트데이"],
    "어버이날": ["어버이날", "카네이션", "효도"],
    "스승의날": ["스승의날", "선생님날"],
    "크리스마스": ["크리스마스", "성탄", "xmas"],
}

# 관계 슬롯 매핑
RELATION_MAP: Dict[str, List[str]] = {
    "친구": ["친구", "베프", "동창", "여사친", "남사친"],
    "연인": ["연인", "커플", "여친", "남친", "여자친구", "남자친구", "girlfriend", "boyfriend"],
    "부모": ["부모", "엄마", "아빠", "어머니", "아버지", "부모님", "mom", "dad", "mother", "father", "parents"],
    "배우자": ["남편", "아내", "신랑", "신부", "spouse", "husband", "wife"],
    "형제자매": ["형제", "자매", "남매", "형", "누나", "언니", "동생"],
    "조카": ["조카", "조카딸", "조카아들"],
    "자녀": ["자녀", "아들", "딸", "아이", "아기", "아동", "초등학생", "중학생", "고등학생"],
    "사촌": ["사촌", "사촌형", "사촌누나", "사촌동생"],
    "선생님": ["선생님", "쌤", "교수님", "담임", "멘토", "teacher", "professor"],
    "직장동료": ["직장", "동료", "팀원", "회사친구", "동기", "선배", "후배", "coworker", "colleague"],
    "상사": ["상사", "팀장", "리더", "boss", "부장", "임원", "매니저", "manager"],
    "후배": ["후배", "막내", "junior"],
    "고객": ["고객", "거래처", "파트너", "클라이언트", "vendor", "buyer"],
    "본인": ["나", "본인", "myself", "me"],
}

# 가중치 힌트
OCCASION_HINTS: Dict[str, List[str]] = {
    "생일": ["생일", "birthday", "bday", "축하"],
    "집들이": ["집들이", "홈", "인테리어", "home"],
    "기념일": ["기념일", "커플", "로맨틱", "감성", "anniv"],
    "감사": ["감사", "thanks", "감동"],
    "졸업": ["졸업", "캠퍼스"],
    "입사": ["입사", "오피스", "데스크", "사무실"],
    "입학/합격": ["입학", "합격", "합격선물", "학기", "캠퍼스"],
    "승진/이직": ["승진", "프로모션", "새직장", "새회사"],
    "결혼": ["결혼", "웨딩", "신혼", "혼수"],
    "출산": ["출산", "육아", "아기"],
    "위로": ["위로", "힐링", "응원", "코지"],
    "여행": ["여행", "휴가", "캠핑", "트래블"],
    "운동": ["운동", "헬스", "러닝", "짐", "피트니스"],
    "집콕/취미": ["집콕", "취미", "덕질", "핸드메이드"],
    "명절": ["명절", "선물세트", "한과"],
    "크리스마스": ["크리스마스", "트리", "산타", "캐럴"],
}

RELATION_HINTS: Dict[str, List[str]] = {
    "친구": ["친구", "캐주얼", "데일리", "센스"],
    "연인": ["연인", "로맨틱", "감성", "커플", "무드"],
    "부모": ["부모", "효도", "웰빙", "건강", "힐링"],
    "배우자": ["배우자", "남편", "아내", "spouse"],
    "형제자매": ["형제", "자매", "남매"],
    "자녀": ["자녀", "아이", "학생", "키즈"],
    "직장동료": ["직장", "오피스", "데스크"],
    "상사": ["상사", "고급", "프리미엄"],
    "선생님": ["선생님", "감사", "정성"],
    "후배": ["후배", "막내"],
    "고객": ["고객", "거래처", "파트너"],
    "본인": ["본인", "myself"],
}

# 금기 동의어/표기 변형
FORBIDDEN_SYNONYMS: Dict[str, List[str]] = {
    "향강한": ["향강한", "향 강한", "강한향", "향진한", "향 짙은", "강한 향", "진한향"],
    "알코올": ["알코올", "술", "주류", "와인", "위스키", "소주", "맥주", "리큐르"],
    "땅콩": ["땅콩", "견과", "호두", "아몬드", "피넛", "캐슈넛", "피스타치오", "브라질너트"],
    "카페인": ["카페인", "고카페인", "에너지드링크", "캡슐커피", "에스프레소"],
    "니켈": ["니켈", "nickel"],
    "라텍스": ["라텍스", "latex"],
    "글루텐": ["글루텐", "밀가루", "wheat"],
    "갑각류": ["새우", "게", "랍스터", "크랩", "크릴", "조개", "굴"],
    "돼지고기": ["돼지고기", "포크", "삼겹살", "돈육"],
    "소고기": ["소고기", "beef", "우육"],
    "매운맛": ["매운맛", "매움", "매콤", "매운", "핫"],
    "강한향수": ["향수", "퍼퓸", "eau de parfum", "edp", "edt"],
}


def make_reverse_map(map_: Dict[str, List[str]]) -> Dict[str, str]:
    """값 리스트의 각 표현 → 표준 키로 역매핑."""
    rev = {}
    for key, vals in map_.items():
        for v in vals:
            rev[nfkc_lower(v)] = key
    return rev


def compile_forbidden_regex(fb: Dict[str, List[str]]) -> Pattern:
    """금기 동의어 전부를 하나의 정규식으로 컴파일."""
    alts = []
    for _, variants in fb.items():
        for v in variants:
            alts.append(re.escape(nfkc_lower(v)))
    pattern = r"(?:%s)" % "|".join(sorted(set(alts), key=len, reverse=True))
    return re.compile(pattern)
